# Ralph Progress Log
Started: Sun Jan 11 22:25:27 CST 2026
---

## Codebase Patterns
- Validation logic lives in `src/lib/{domain}/validation.ts` with matching `.test.ts` files
- Use Zod schemas for form validation, helper functions for async/business logic
- Mock Supabase client in tests using `vi.mock("@/lib/supabase/client")` and `vi.mocked(createClient)`
- Tests use describe/it pattern with safeParse for schema tests, async/await for function tests
- Form components use react-hook-form with zodResolver
- Use `ilike()` for case-insensitive Supabase queries
- Toast notifications: import `{ toast } from "sonner"` - use `toast.success()` and `toast.error()`
- Vitest setup file at `vitest.setup.ts` imports `@testing-library/jest-dom/vitest` for matchers
- For component tests with user interactions, install `@testing-library/user-event` and use `userEvent.setup()`
- When mocking Supabase delete with chained `.eq()`, mock returns objects with nested `.eq()` methods
- Use `vi.hoisted()` for mock variables used in `vi.mock()` factory functions to avoid hoisting issues
- When testing Radix Dialog, find dialog buttons by `data-variant` attribute rather than index
- **Date handling**: Use `formatDate()` and `calculateWeekDates()` from `@/lib/dates/dateUtils` for timezone-safe date operations
---

## 2026-01-12 04:29 CST - US-V4-001
- What was implemented:
  - Added `validateSeasonName()` function to check for duplicate season names (case-insensitive)
  - Integrated validation into season creation form with onBlur and onSubmit checks
  - Added inline error display and loading state while validating
  - Submit button disabled when name is invalid or validation in progress
- Files changed:
  - src/lib/seasons/validation.ts (added validateSeasonName function and types)
  - src/lib/seasons/validation.test.ts (added 7 tests for validateSeasonName)
  - src/app/dashboard/seasons/new/page.tsx (added validation UI and handlers)
- **Learnings for future iterations:**
  - Supabase `ilike()` filter does case-insensitive matching but doesn't do exact match, so follow up with JS comparison
  - When mocking Supabase client, use chained mocks: `from().select().eq().ilike()`
  - Form validation on blur requires both calling field.onBlur() and custom handler
---

## 2026-01-12 04:36 CST - US-V4-002
- What was implemented:
  - Added `validatePlayerNameForDuplicate()` function for case-insensitive duplicate player name checking
  - Added `normalizePlayerName()` helper to trim whitespace and collapse multiple spaces
  - Integrated validation into RosterManager component with onBlur and onSubmit checks
  - Added inline warning message with option to add existing player to season instead
  - Submit button disabled when name is invalid or validation in progress
- Files changed:
  - src/lib/players/validation.ts (added validatePlayerNameForDuplicate, normalizePlayerName, and types)
  - src/lib/players/validation.test.ts (added 14 tests for duplicate detection and normalization)
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added validation UI and handlers)
- **Learnings for future iterations:**
  - Player validation pattern mirrors season validation but adds `normalizePlayerName()` for space collapsing
  - When showing duplicate warning, provide option to add existing player to roster as alternative action
  - Use regex `/\s+/g` to collapse multiple spaces to single space
---

## 2026-01-12 04:41 CST - US-V4-016
- What was implemented:
  - Added Toaster component to root layout (src/app/layout.tsx) with position: bottom-right, duration: 4000ms
  - Added toast.success() for season creation in new season page
  - Added toast.success() for player added to roster (both new and existing players)
  - Added toast.error() for failed saves and API errors
  - Created vitest.setup.ts with @testing-library/jest-dom/vitest for test matchers
  - Created layout.test.tsx with 4 tests for Toaster configuration
- Files changed:
  - src/app/layout.tsx (added Toaster import and component)
  - src/app/layout.test.tsx (new - 4 tests for Toaster)
  - src/app/dashboard/seasons/new/page.tsx (added toast calls for success/error)
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added toast calls for player add/error)
  - vitest.config.ts (added setupFiles)
  - vitest.setup.ts (new - jest-dom matchers setup)
  - package.json (added @testing-library/jest-dom)
- **Learnings for future iterations:**
  - Sonner Toaster is a client component that can be added to server layout components
  - Mock sonner's Toaster in component tests to inspect props via data attributes
  - Root layout tests will show HTML nesting warnings (expected, not an error)
---

## 2026-01-12 04:47 CST - US-V4-003
- What was implemented:
  - Added confirmation dialog for player removal using existing Dialog component
  - Dialog shows "Remove [Player Name] from this season's roster?"
  - Cancel button closes dialog without action
  - Remove button executes removal with toast.success('[Player Name] removed from roster')
  - Added toast.error() for failed removal API calls
  - Created comprehensive test file for roster-manager component
- Files changed:
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added dialog state, handlers, and Dialog component)
  - src/app/dashboard/seasons/[id]/roster-manager.test.tsx (new - 7 tests for confirmation dialog)
  - package.json (added @testing-library/user-event)
- **Learnings for future iterations:**
  - Use `vi.hoisted()` for mock variables referenced in `vi.mock()` factory functions
  - Radix Dialog portal renders outside main DOM tree; use `findByRole("dialog")` then query within
  - Find buttons in dialog by `data-variant` attribute (e.g., `data-variant="destructive"`)
  - Chain Supabase mocks properly: `.delete().eq().eq()` needs nested mock objects
---

## 2026-01-12 04:50 CST - US-V4-004
- What was implemented:
  - Added visible warning message (yellow Alert) above Generate Schedule button when player count is invalid
  - Button was already disabled via validation logic, tooltip already showing disabled reason
  - Created comprehensive test file with 9 tests covering disabled states, warning visibility, and boundary conditions
- Files changed:
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-generator.tsx (added warning Alert)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-generator.test.tsx (new - 9 tests)
- **Learnings for future iterations:**
  - Schedule generation component already had good validation infrastructure via `validateAvailableCount()`
  - MIN_AVAILABLE_PLAYERS (24) and MAX_AVAILABLE_PLAYERS (32) constants from `src/lib/availability/validation.ts`
  - Component tests for this component don't need complex Supabase mocking since generation is client-side
---

## 2026-01-12 04:54 CST - US-V4-005
- What was implemented:
  - Simplified `findActiveWeekId()` function to return the earliest non-completed week (by week_number)
  - Previously the function was overly complex, tracking "closest to today" logic that wasn't needed
  - Created comprehensive test file with 12 tests covering tab styling, navigation, active week label, and findActiveWeekId logic
- Files changed:
  - src/app/dashboard/seasons/[id]/week-utils.ts (simplified findActiveWeekId function)
  - src/app/dashboard/seasons/[id]/week-navigation.test.tsx (new - 12 tests)
- **Learnings for future iterations:**
  - Radix Tabs uses `data-state="active"` attribute for selected tab styling
  - WeekNavigation renders both mobile and desktop views, so tests should use `getAllByText` when searching for week numbers
  - `findActiveWeekId` sorts by week_number to handle unsorted input arrays correctly
---

## 2026-01-12 04:59 CST - US-V4-006
- What was implemented:
  - Created `src/lib/dates/dateUtils.ts` with timezone-safe date utility functions
  - Added `formatDate()` - displays YYYY-MM-DD dates without timezone conversion (no off-by-one bugs)
  - Added `parseDateString()` - extracts year/month/day components from date string
  - Added `parseFormDate()` - validates and normalizes form date inputs
  - Added `calculateWeekDates()` - calculates week dates without timezone bugs (replaces old version)
  - Added `addDays()` - adds/subtracts days from date strings safely
  - Updated all formatDate usage across dashboard, season, week, and player pages
  - Updated week-navigation.tsx to use timezone-safe formatDateCompact and formatDateFull
  - Re-exported calculateWeekDates from validation.ts to maintain backwards compatibility
  - Fixed existing test that had wrong expected value due to old timezone bug
- Files changed:
  - src/lib/dates/dateUtils.ts (new - date utility functions)
  - src/lib/dates/dateUtils.test.ts (new - 33 comprehensive tests)
  - src/lib/seasons/validation.ts (re-export calculateWeekDates from dateUtils)
  - src/lib/seasons/validation.test.ts (fixed date expectation from "2026-03-18" to "2026-03-19")
  - src/app/dashboard/page.tsx (import formatDate from dateUtils)
  - src/app/dashboard/seasons/[id]/page.tsx (import formatDate from dateUtils)
  - src/app/dashboard/seasons/[id]/week-navigation.tsx (use timezone-safe date formatting)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/page.tsx (import formatDate from dateUtils)
  - src/app/dashboard/seasons/[id]/players/[playerId]/page.tsx (import formatDate from dateUtils)
- **Learnings for future iterations:**
  - `new Date("YYYY-MM-DD")` interprets as UTC midnight, causing off-by-one in timezones behind UTC
  - To display dates timezone-safely, parse components directly from string and format manually
  - `new Date(year, month-1, day)` creates a local date without timezone conversion
  - When fixing timezone bugs, existing tests may have wrong expected values that were "correct" for the buggy code
---

## 2026-01-12 05:06 CST - US-V4-007
- What was implemented:
  - Created `/dashboard/seasons/[id]/roster/page.tsx` - server component for roster management
  - Created `/dashboard/seasons/[id]/schedule/page.tsx` - server component with week listing and navigation
  - Created `/dashboard/seasons/[id]/leaderboard/page.tsx` - server component for player rankings
  - Updated `[id]/page.tsx` to redirect to `/schedule` by default (simplified to just redirect)
  - Each page fetches its own data independently (server component pattern)
  - Extracted existing RosterManager and Leaderboard components used as-is in new pages
- Files changed:
  - src/app/dashboard/seasons/[id]/roster/page.tsx (new - roster management page)
  - src/app/dashboard/seasons/[id]/schedule/page.tsx (new - week schedule listing)
  - src/app/dashboard/seasons/[id]/leaderboard/page.tsx (new - player rankings)
  - src/app/dashboard/seasons/[id]/page.tsx (simplified to redirect only)
- **Learnings for future iterations:**
  - Next.js dynamic routes with `[id]` need proper quoting in shell commands due to bracket characters
  - Server components can import client components (e.g., RosterManager) but not vice versa
  - Each route page can do its own data fetching - good for code splitting and isolation
  - redirect() from next/navigation doesn't return, so no need for further code after it
---

## 2026-01-12 05:09 CST - US-V4-008
- What was implemented:
  - Created SeasonNav component in src/app/dashboard/seasons/[id]/components/
  - Links to: Roster (/roster), Schedule (/schedule), Leaderboard (/leaderboard)
  - On mobile (< 768px): Fixed bottom navigation bar with icons
  - On desktop (>= 768px): Horizontal tabs below season header
  - Uses lucide-react icons: Users (roster), Calendar (schedule), Trophy (leaderboard)
  - Current section indicated via data-active attribute and active styling (blue border/text)
  - Touch targets minimum 44px on mobile (min-h-[44px] min-w-[44px])
  - Navigation is sticky (fixed bottom on mobile)
  - Added SeasonNav to roster/page.tsx, schedule/page.tsx, leaderboard/page.tsx
- Files changed:
  - src/app/dashboard/seasons/[id]/components/SeasonNav.tsx (new - responsive nav component)
  - src/app/dashboard/seasons/[id]/components/SeasonNav.test.tsx (new - 14 comprehensive tests)
  - src/app/dashboard/seasons/[id]/roster/page.tsx (added SeasonNav import and component)
  - src/app/dashboard/seasons/[id]/schedule/page.tsx (added SeasonNav import and component)
  - src/app/dashboard/seasons/[id]/leaderboard/page.tsx (added SeasonNav import and component)
- **Learnings for future iterations:**
  - Use usePathname() from next/navigation to determine current route for active state
  - Mock next/navigation in tests with vi.mock() and vi.mocked(usePathname)
  - Use data-testid for responsive elements to verify presence in DOM
  - Tailwind responsive classes: md:hidden (show on mobile only), hidden md:block (show on desktop only)
  - For client components imported into server components, mark with "use client" directive
---

## 2026-01-12 05:14 CST - US-V4-009
- What was implemented:
  - Created filter utility functions in src/lib/games/filters.ts
  - filterGamesByRound() returns games from specific round, sorted by court
  - filterGamesByCourt() returns games from specific court, sorted by round
  - getFilterSummary() shows "Showing X games | Y of X completed"
  - getDefaultFilterState() defaults to "By Round" with Round 1 selected
  - Added filter UI to score-entry.tsx with toggle and dropdown
  - Summary text shows filtered game count and completion status
- Files changed:
  - src/lib/games/filters.ts (new - filter utility functions)
  - src/lib/games/filters.test.ts (new - 18 tests for filter functions)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/score-entry.tsx (added filter UI)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/score-entry.test.tsx (new - 11 tests for component)
- **Learnings for future iterations:**
  - Extract filter logic to pure functions for easy testing (filterGamesByRound, filterGamesByCourt)
  - Use data-testid for elements that need to be queried by test but might have duplicate text content
  - When testing components with duplicate text, use getByTestId or getAllByText instead of getByText
  - Game filtering: sort by court_number when filtering by round, sort by round_number when filtering by court
---

## 2026-01-12 05:19 CST - US-V4-010
- What was implemented:
  - Added collapsible roster view with expand/collapse toggle button
  - Used ChevronDown/ChevronRight icons from lucide-react for toggle indicator
  - Collapsed state shows player count summary: "(X players in roster)"
  - Expanded state shows full player list with add/remove functionality
  - Collapse state persisted to localStorage key 'roster-collapsed'
  - Smooth animation using Tailwind transitions (max-h, opacity, duration-300)
  - Added 7 new tests for collapsible functionality
- Files changed:
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added collapse state, toggle, icons)
  - src/app/dashboard/seasons/[id]/roster-manager.test.tsx (added localStorage mock, 7 collapse tests)
- **Learnings for future iterations:**
  - Avoid calling setState in useEffect - use lazy initializer with useState(() => ...) instead
  - The `react-hooks/set-state-in-effect` ESLint rule enforces this pattern
  - Mock localStorage at file scope and reset in beforeEach to share across describe blocks
  - Use `typeof window !== "undefined"` check for SSR-safe localStorage access
  - Tailwind's max-h-[2000px] with transition-all provides smooth collapse animation
---

## 2026-01-12 05:27 CST - US-V4-011
- What was implemented:
  - Added getValidSwapTargets() function to src/lib/scheduling/swap.ts
  - Enhanced schedule-viewer.tsx with complete swap selection mode UI:
    - Selected player shows blue ring highlight (ring-2 ring-blue-500)
    - Valid swap targets show green background (bg-green-100)
    - Players in other rounds dimmed (opacity-50) and not clickable
    - Cancel button in swap banner to exit swap mode
    - Escape key listener to cancel swap mode
  - Created comprehensive component tests for swap mode (13 tests)
  - Added 7 tests for getValidSwapTargets function
- Files changed:
  - src/lib/scheduling/swap.ts (added getValidSwapTargets function)
  - src/lib/scheduling/swap.test.ts (added 7 tests for getValidSwapTargets)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.tsx (enhanced swap UI)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.test.tsx (new - 13 tests)
  - src/lib/pdf/exportSchedulePdf.test.ts (fixed pre-existing type error)
- **Learnings for future iterations:**
  - Much of the swap functionality already existed in codebase - check existing code first
  - Use useEffect for keyboard listeners with cleanup function
  - For visual states, compute valid targets as a Set for O(1) lookups
  - Test Radix/shadcn components with data-testid attributes for reliable selectors
  - Component tests need full game type (status, updated_at fields) to match database types
---

## 2026-01-12 05:31 CST - US-V4-012
- What was implemented:
  - Added toast.success() notification after successful swap execution
  - Added confirmation dialog when clicking Regenerate with existing schedule
  - Swap execution was already working - enhanced with toast feedback
  - Unsaved changes indicator and Save button already existed
  - Added 4 tests for swap execution behavior
- Files changed:
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.tsx (added toast import and call)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.test.tsx (added swap execution tests)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-generator.tsx (added regenerate confirm dialog)
- **Learnings for future iterations:**
  - Much of swap execution already existed - just needed toast notification
  - Dialog components from shadcn/radix handle accessibility automatically
  - ScheduleGenerator and ScheduleViewer are sibling components - shared state would require lifting up to page
  - For server component pages, shared client state requires client component wrappers
---

## 2026-01-12 05:34 CST - US-V4-013
- What was implemented:
  - Created `src/lib/pdf/exportScoreSheetsPdf.ts` with PDF generation for printable score sheets
  - PDF layout: landscape letter format, one page per round, 3-column grid of court boxes
  - Each court box shows: court number (header), team 1 players, team 2 players, empty score boxes (60pt squares)
  - Page headers include: season name, week number, date, and round number
  - Footer with page numbers ("Page X of Y")
  - Exported `generateCourtBox()` helper function for testing
  - Added "Export Score Sheets" button to schedule-viewer.tsx (next to existing Export PDF)
  - Created comprehensive test file with 14 tests
- Files changed:
  - src/lib/pdf/exportScoreSheetsPdf.ts (new - PDF generation for score sheets)
  - src/lib/pdf/exportScoreSheetsPdf.test.ts (new - 14 tests)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.tsx (added button and import)
- **Learnings for future iterations:**
  - jsPDF `rect()` can draw filled rectangles with "F" flag for filled: `doc.rect(x, y, w, h, "F")`
  - Score box size of 60pt (~0.83 inch) is comfortable for handwritten scores
  - Landscape letter size is 792x612 points (width x height)
  - Reference existing PDF code (`exportSchedulePdf.ts`) for consistent patterns and mock setup
---

## 2026-01-12 05:40 CST - US-V4-014
- What was implemented:
  - Created `src/lib/players/bulkImport.ts` with parsing and duplicate detection functions
  - Added `parsePlayerNames()` to split on newlines/commas, trim whitespace, filter empty entries
  - Added `findDuplicates()` for case-insensitive duplicate detection against existing player pool
  - Added `getImportPreviewSummary()` for human-readable preview text
  - Created Textarea UI component (`src/components/ui/textarea.tsx`)
  - Added "Bulk Import" button and dialog to roster-manager.tsx
  - Dialog shows preview of names to import with duplicate warnings
  - On import: creates new players in players table, adds all to season_players
  - Toast success message shows count of added players and skipped duplicates
  - Created comprehensive test file with 23 tests for parsing and duplicate detection
- Files changed:
  - src/lib/players/bulkImport.ts (new - parsing and duplicate detection functions)
  - src/lib/players/bulkImport.test.ts (new - 23 tests)
  - src/components/ui/textarea.tsx (new - Textarea UI component)
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added bulk import UI)
- **Learnings for future iterations:**
  - useMemo for computed preview state avoids recalculating on every render
  - For dialog close, reset state in onOpenChange handler when open becomes false
  - Supabase error code "23505" is unique constraint violation (duplicate key)
  - findExistingPlayer helper allows looking up existing player by name for roster membership check
---

## 2026-01-12 05:41 CST - US-V4-015
- What was implemented:
  - Created `PasswordRequirements` component with real-time validation indicators
  - Added `validatePasswordRequirements()` function checking: minLength (8+), hasUppercase, hasLowercase, hasNumber
  - Added `getPasswordStrength()` function returning weak (<8), medium (8-12), or strong (12+)
  - Used Check (green) and Circle (gray) icons from lucide-react for requirement indicators
  - Integrated component below password field on registration page
  - Created comprehensive test file with 22 tests covering validation logic and component rendering
- Files changed:
  - src/app/register/PasswordRequirements.tsx (new - validation component)
  - src/app/register/PasswordRequirements.test.tsx (new - 22 tests)
  - src/app/register/page.tsx (imported and added PasswordRequirements to password field)
- **Learnings for future iterations:**
  - Password validation requirements should match the zod schema in the form (8 chars, uppercase, lowercase, number)
  - Use data-testid for icons to reliably query in tests (lucide icons don't have predictable accessible names)
  - The registration page already has a controlled form via react-hook-form, so real-time validation works via field.value
---

## 2026-01-12 05:49 CST - US-V4-016
- What was implemented:
  - Added "Forgot password?" link on login page next to password label
  - Created /forgot-password page with email form to request password reset
  - Created /reset-password page with new password + confirm password form
  - Login page shows "Password reset successfully" message when reset=success in URL
  - Reset page validates session before showing form, handles expired/invalid links
  - Password validation uses same zod schema as registration (8+ chars, uppercase, lowercase, number)
  - Created comprehensive test files with 20 tests total (9 for forgot-password, 11 for reset-password)
  - Wrapped login page content in Suspense boundary for useSearchParams
- Files changed:
  - src/app/login/page.tsx (added forgot password link, reset success message, Suspense wrapper)
  - src/app/forgot-password/page.tsx (new - email form for password reset request)
  - src/app/forgot-password/page.test.tsx (new - 9 tests)
  - src/app/reset-password/page.tsx (new - password reset form)
  - src/app/reset-password/page.test.tsx (new - 11 tests)
- **Learnings for future iterations:**
  - Components using useSearchParams must be wrapped in Suspense boundary for static generation
  - Use vi.hoisted() for mock functions referenced in vi.mock() factory
  - For async state updates in tests, use screen.findByX to wait for elements to appear
  - CardTitle is a div, not a heading element - use screen.getByText instead of getByRole("heading")
  - Mock Supabase auth methods: getSession, resetPasswordForEmail, updateUser, signOut
---

## 2026-01-12 05:54 CST - US-V4-017
- What was implemented:
  - Created `src/lib/players/search.ts` with `filterPlayers()` utility function
  - Case-insensitive partial matching using `toLowerCase().includes()`
  - Trims whitespace from search query before matching
  - Added search input with Search icon above player list in roster-manager.tsx
  - Real-time filtering via useState and useMemo
  - Clear button (X icon) appears when search has text, clears on click
  - Shows "No players found" message when filter returns empty but roster has players
  - Created comprehensive test file with 15 tests for filterPlayers function
  - Added 8 component tests for search functionality in roster-manager.test.tsx
- Files changed:
  - src/lib/players/search.ts (new - filterPlayers utility function)
  - src/lib/players/search.test.ts (new - 15 tests)
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added search UI, icons, state)
  - src/app/dashboard/seasons/[id]/roster-manager.test.tsx (added 8 search tests)
- **Learnings for future iterations:**
  - Use useMemo for filtering computed values to avoid recalculating on every render
  - Search input appears only when there are players in roster (conditional rendering)
  - lucide-react provides Search and X icons for common search patterns
  - Test assertions need to match actual substring behavior ("Jones" does NOT contain "son", it contains "ones")
---

## 2026-01-12 05:58 CST - US-V4-018
- What was implemented:
  - Created `src/lib/games/progress.ts` with `calculateProgress()` and `isGameComplete()` functions
  - Added progress indicator UI to score-entry component at top of CardContent
  - Progress text shows "X of Y games completed (Z%)"
  - Visual progress bar with green fill (bg-green-500) and smooth transition
  - CheckCircle icon appears next to text when 100% complete
  - Progress tracks ALL games (not just filtered), updates reactively via useMemo
  - Created comprehensive test file with 12 tests for progress functions
  - Added 5 component tests for progress indicator in score-entry.test.tsx
- Files changed:
  - src/lib/games/progress.ts (new - calculateProgress, isGameComplete functions)
  - src/lib/games/progress.test.ts (new - 12 tests)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/score-entry.tsx (added progress UI)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/score-entry.test.tsx (added 5 progress tests)
- **Learnings for future iterations:**
  - Progress should track all games, not just filtered games, for accurate overall completion
  - Use data-testid for styled elements that need assertions on style properties (like width %)
  - `useMemo` with game dependency ensures progress updates when scores are saved
  - Math.round() for percentage provides clean integer display
---

## 2026-01-12 06:03 CST - US-V4-019
- What was implemented:
  - Added loading indicators using Loader2 icon from lucide-react with animate-spin class
  - Updated Generate Schedule button to show "Generating..." with spinner during async operation
  - Updated Save Schedule button to show "Saving..." with spinner during async operation
  - Updated Score Entry Save buttons to show "Saving..." with spinner when saving individual game scores
  - Updated PDF export buttons (Export PDF and Export Score Sheets) with loading states and "Exporting..." text
  - Updated Finalize, Unfinalize, and Mark Complete dialog buttons with loading states
  - All buttons disabled during loading to prevent double-clicks
  - Used try/finally pattern to ensure loading state clears on both success and error
  - Removed custom LoadingSpinner SVG in favor of consistent Loader2 icon usage
  - Added data-testid attributes for reliable test querying
  - Added 7 new tests across schedule-generator.test.tsx and schedule-viewer.test.tsx
- Files changed:
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-generator.tsx (Loader2 import, spinner buttons)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-generator.test.tsx (3 loading state tests)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.tsx (Loader2 import, PDF export loading, dialog loading)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/schedule-viewer.test.tsx (4 loading state tests)
  - src/app/dashboard/seasons/[id]/weeks/[weekId]/score-entry.tsx (Loader2 import, save button spinner)
- **Learnings for future iterations:**
  - Loader2 from lucide-react with animate-spin provides consistent loading indicator across app
  - Pattern: disabled={isLoading} prevents double-clicks during async operations
  - try/finally ensures loading state always clears, preventing stuck loading states
  - PDF export functions can be wrapped with async/await for consistent loading pattern
---
