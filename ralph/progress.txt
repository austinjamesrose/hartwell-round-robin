# Ralph Progress Log
Started: 2026-01-11
---

## Codebase Patterns
- Supabase clients in src/lib/supabase/ - client.ts (browser), server.ts (RSC/Route Handlers), middleware.ts
- Database types defined in src/types/database.ts - must match supabase/schema.sql
- UI components from shadcn/ui in src/components/ui/
- Use `npm run lint` to check ESLint (must pass with 0 errors/warnings)
- Use `npm run build` to verify TypeScript and production build
- Use `npm run test` to run vitest unit tests
- Environment variables in .env.local (copy from .env.local.example)
- Auth route logic in src/lib/auth/routes.ts - testable helper functions for middleware
- Protected routes redirect unauthenticated users to /login
- Public routes: /, /login, /register, /auth/callback

---

## 2026-01-11 - US-000
- Project setup completed (was partially pre-configured)
- Updated homepage with proper app Card layout
- Added .gitignore file
- Fixed unused import warning in src/lib/supabase/server.ts
- Verified npm run dev and npm run build work
- Files changed: .gitignore (new), src/app/page.tsx, src/lib/supabase/server.ts
- **Learnings for future iterations:**
  - Project uses Next.js 16.1.1 (Turbopack) with App Router
  - Tailwind v4 with oklch colors in globals.css
  - Database schema in supabase/schema.sql ready to apply to Supabase
  - ESLint configured via eslint.config.mjs (flat config format)
---

## 2026-01-11 - US-001
- Implemented complete authentication flow with Supabase Auth
- Login page with email/password form and zod validation
- Registration page with email confirmation flow
- Auth callback route handler for email verification (/auth/callback)
- Root middleware for protected routes (redirects unauthenticated to /login)
- Dashboard page as authenticated landing with logout button
- Added vitest for unit testing
- Files created:
  - src/app/login/page.tsx
  - src/app/register/page.tsx
  - src/app/auth/callback/route.ts
  - src/app/dashboard/page.tsx
  - src/app/dashboard/logout-button.tsx
  - src/lib/auth/routes.ts
  - src/lib/auth/routes.test.ts
  - middleware.ts
  - vitest.config.ts
- **Learnings for future iterations:**
  - Extract testable logic from middleware into separate modules (src/lib/auth/routes.ts pattern)
  - react-hook-form with zod resolver for form validation (@hookform/resolvers)
  - Supabase auth uses exchangeCodeForSession for email confirmation
  - Authenticated users redirected from /login and /register to /dashboard
  - Session persists via Supabase SSR cookies automatically
---

## 2026-01-11 - US-002
- Created season form with validation (name, start date, weeks 1-12, courts 4-8)
- Zod schema for validation with trimmed names
- Auto-creation of week schedules based on season start date
- Season detail page showing all created weeks with status badges
- Unit tests for validation rules and calculateWeekDates function
- Files created:
  - src/lib/seasons/validation.ts
  - src/lib/seasons/validation.test.ts
  - src/app/dashboard/seasons/new/page.tsx
  - src/app/dashboard/seasons/[id]/page.tsx
- Files modified:
  - src/types/database.ts (added Relationships and CompositeTypes for Supabase v2.90)
- **Learnings for future iterations:**
  - Database types need `Relationships: []` and `CompositeTypes` for Supabase v2.90+ compatibility
  - Use explicit type annotations (e.g., `const data: InsertType = {...}`) when Supabase insert types resolve to `never`
  - Zod `.default()` creates optional input types - use form default values instead for react-hook-form compatibility
  - `notFound()` from Next.js needs `return notFound()` for proper TypeScript control flow narrowing
  - Season routes: /dashboard/seasons/new (create), /dashboard/seasons/[id] (view)
---

## 2026-01-11 - US-003
- Updated dashboard to display all seasons owned by the admin
- Each season shows: name, start date, status (active/completed/archived), current week
- Seasons are clickable cards that navigate to /dashboard/seasons/[id]
- Added prominent "Create New Season" button at top of dashboard
- getCurrentWeek() helper calculates which week is active based on today's date
- Files modified:
  - src/app/dashboard/page.tsx (complete rewrite with season list)
  - src/types/database.ts (added Relationships for seasons/weeks join)
- **Learnings for future iterations:**
  - Supabase join queries with `select('*, weeks(*)')` require relationship types defined in database.ts
  - Use `as unknown as Type` for intermediate casting when Supabase types don't match actual runtime structure
  - RLS is already enforced on seasons table via `auth.uid() = admin_id` policy - no additional code needed
---

## 2026-01-11 - US-004
- Added roster management to season detail page
- Player pool dropdown with Select component to add existing players
- "Create & Add" form for creating new players and adding to roster immediately
- Duplicate player prevention via Set lookup and database unique constraint
- Roster displays alphabetically sorted with player count
- Unit tests for validation schemas and helper functions
- Files created:
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (client component)
  - src/lib/players/validation.ts
  - src/lib/players/validation.test.ts
  - src/components/ui/select.tsx (shadcn component)
- Files modified:
  - src/app/dashboard/seasons/[id]/page.tsx (fetch players, add RosterManager)
- **Learnings for future iterations:**
  - Use `npx shadcn@latest add <component> -y` to add new shadcn UI components
  - Supabase unique constraint violations return error code "23505"
  - Join queries: `select('player_id, players(*)')` returns nested object, needs `sp.players as unknown as Player`
  - Validation helpers like `isPlayerInSeason()` should use Set<string> for O(1) lookup
---
