# Ralph Progress Log
Started: Sun Jan 11 22:25:27 CST 2026
---

## Codebase Patterns
- Validation logic lives in `src/lib/{domain}/validation.ts` with matching `.test.ts` files
- Use Zod schemas for form validation, helper functions for async/business logic
- Mock Supabase client in tests using `vi.mock("@/lib/supabase/client")` and `vi.mocked(createClient)`
- Tests use describe/it pattern with safeParse for schema tests, async/await for function tests
- Form components use react-hook-form with zodResolver
- Use `ilike()` for case-insensitive Supabase queries
---

## 2026-01-12 04:29 CST - US-V4-001
- What was implemented:
  - Added `validateSeasonName()` function to check for duplicate season names (case-insensitive)
  - Integrated validation into season creation form with onBlur and onSubmit checks
  - Added inline error display and loading state while validating
  - Submit button disabled when name is invalid or validation in progress
- Files changed:
  - src/lib/seasons/validation.ts (added validateSeasonName function and types)
  - src/lib/seasons/validation.test.ts (added 7 tests for validateSeasonName)
  - src/app/dashboard/seasons/new/page.tsx (added validation UI and handlers)
- **Learnings for future iterations:**
  - Supabase `ilike()` filter does case-insensitive matching but doesn't do exact match, so follow up with JS comparison
  - When mocking Supabase client, use chained mocks: `from().select().eq().ilike()`
  - Form validation on blur requires both calling field.onBlur() and custom handler
---

## 2026-01-12 04:36 CST - US-V4-002
- What was implemented:
  - Added `validatePlayerNameForDuplicate()` function for case-insensitive duplicate player name checking
  - Added `normalizePlayerName()` helper to trim whitespace and collapse multiple spaces
  - Integrated validation into RosterManager component with onBlur and onSubmit checks
  - Added inline warning message with option to add existing player to season instead
  - Submit button disabled when name is invalid or validation in progress
- Files changed:
  - src/lib/players/validation.ts (added validatePlayerNameForDuplicate, normalizePlayerName, and types)
  - src/lib/players/validation.test.ts (added 14 tests for duplicate detection and normalization)
  - src/app/dashboard/seasons/[id]/roster-manager.tsx (added validation UI and handlers)
- **Learnings for future iterations:**
  - Player validation pattern mirrors season validation but adds `normalizePlayerName()` for space collapsing
  - When showing duplicate warning, provide option to add existing player to roster as alternative action
  - Use regex `/\s+/g` to collapse multiple spaces to single space
---
